function spriteSheet(a,b){var c=a.width/b;return{image:a,nFrames:b,frameWidth:c,frameHeight:a.height}}function drawSpriteObject(a,b,c){c||(c=0);var d=b.sheet;a.drawImage(b.sheet.image,(c+b.animIndex)*d.frameWidth,0,d.frameWidth,d.frameHeight,b.x,b.y,d.frameWidth,d.frameHeight)}function tickSpriteObject(a){++a.tick===a.animTicks&&(animateSpriteObject(a),a.tick=0)}function animateSpriteObject(a){++a.animIndex===a.animLength&&(a.animIndex=0)}function game(a,b,c,d,e,f,g){function h(){var c=a.offsetWidth,d=a.offsetHeight,e=Math.floor(c/b.width),f=Math.floor(d/b.height),g=Math.max(Math.min(e,f),1),h=b.width*g,i=b.height*g;k.width=h,k.height=i,k.style.width=h+"px",k.style.height=i+"px",l.imageSmoothingEnabled=!1,l.mozImageSmoothingEnabled=!1,l.webkitImageSmoothingEnabled=!1,l.msImageSmoothingEnabled=!1,l.scale(g,g)}function i(a){window.requestAnimationFrame(i);var b=a-n;b>=j&&(d(m),c(l,m),n=a-b%j)}a.style.display="flex",a.style.justifyContent="center",a.style.alignItems="center";var j=1e3/b.fps,k=document.createElement("canvas");a.appendChild(k);var l=k.getContext("2d");h();var m=g;e.forEach(function(a){window.addEventListener(a.name,function(b){a.fn(b,m)})}),f.forEach(function(a){k.addEventListener(a.name,function(b){a.fn(b,m)})});var n=0;return window.requestAnimationFrame(i),h}function main(){var a=spriteSheet(document.getElementById("pasi"),4),b={pasi:{animIndex:0,animLength:2,sheet:a,tick:0,animTicks:5,vx:0,vy:0,pose:1,x:0,y:config.height-a.frameHeight,leaping:!1,leapTick:0}},c=game(document.getElementsByTagName("body")[0],config,draw,update,[{name:"keydown",fn:keydown},{name:"keyup",fn:keyup},{name:"deviceorientation",fn:orientation}],[],b);window.addEventListener("resize",c)}function draw(a,b){a.clearRect(0,0,config.width,config.height);var c=-1===b.pasi.pose?2:0;drawSpriteObject(a,b.pasi,c)}function update(a){a.pasi.leaping?tickPasi(a.pasi):(a.pasi.vy+=config.g,a.pasi.x+=a.pasi.vx,a.pasi.x>config.width?a.pasi.x=-a.pasi.sheet.frameWidth:a.pasi.x<-a.pasi.sheet.frameWidth&&(a.pasi.x=config.width),a.pasi.y+=a.pasi.vy,a.pasi.y>=config.height-a.pasi.sheet.frameHeight&&(a.pasi.y=config.height-a.pasi.sheet.frameHeight,startLeaping(a.pasi)))}function startLeaping(a){a.leaping=!0,a.leapTick=0,a.animIndex=1}function tickPasi(a){++a.leapTick===config.pasiLeapTicks&&(a.leaping=!1,a.animIndex=0,a.vy=-config.pasiJumpSpeed)}function keydown(a,b){39===a.keyCode?(b.pasi.vx=config.pasiSpeed,b.pasi.pose=1):37===a.keyCode&&(b.pasi.vx=-config.pasiSpeed,b.pasi.pose=-1)}function keyup(a,b){39===a.keyCode&&b.pasi.vx>0?b.pasi.vx=0:37===a.keyCode&&b.pasi.vx<0&&(b.pasi.vx=0)}function orientation(a,b){b.pasi.vx=a.gamma*config.pasiSpeed/10,b.pasi.pose=a.gamma>0?1:-1}var config={width:180,height:240,fps:20,pasiSpeed:2,pasiJumpSpeed:12,pasiLeapTicks:4,g:1};window.addEventListener("load",main);